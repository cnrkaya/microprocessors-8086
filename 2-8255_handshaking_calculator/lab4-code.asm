;====================================================================
; Main.asm file generated by New Project wizard
;
; Created:   Per Ãžub 11 2016
; Processor: 8086
; Compiler:  MASM32
;
; Before starting simulation set Internal Memory Size 
; in the 8086 model properties to 0x10000
;====================================================================

CODE    SEGMENT PARA 'CODE'
       
	
STAK    SEGMENT PARA STACK 'STACK'
        DW 20 DUP(?)
STAK    ENDS

DATA    SEGMENT PARA 'MYDATA'
TYPES 		DB 02H, 00H, 01H, 00H, 02H, 01H, 01H, 01H, 02H, 01H, 01H, 01H, 02H, 01H, 01H, 01H ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
DECIMAL		DB 00H, 01H, 00H, 03H, 04H, 03H, 02H, 01H, 08H, 06H, 05H, 04H, 012H, 09H, 08H, 07H
SAYI1_CTR  	DB 00H
OP_CTR   	DB 00H
SAYI2_CTR   	DB 00H
SONUC		DB 00H
SAYI1		DW 0000H
SAYI2		DW 0000H
OP		DW 0000H
DATA    ENDS

ASSUME CS:CODE, DS:DATA, SS:STAK


START PROC FAR

    PUSH DS
    XOR AX,AX
    PUSH AX
    MOV AX,DATA
    MOV DS,AX

    MOV DX, 406H ;CONTROL WORD ADRESI
    MOV AL,09H
    OUT DX, AL
    MOV AL,05H
    OUT DX,AL
    MOV AL,0BCH
    OUT DX,AL
    
    ;BASLANGICTA LEDLERI SONDUR
    MOV AL,0FFH
    MOV DX,402H
    OUT DX,AL
 RES:   
    CALL RESET
    CALL SAYILARI_YAZDIR
	 
ENDLESS:  

   TUS_YOK:
   MOV DX,0404H  ;STATUS WORD
   IN AL,DX
   TEST AL,08H
   JZ TUS_YOK
   
   CALL TUSU_KAYDET
   CMP DX,-1 ;HATALI VEYA ON/OF TUSU GELDIYSE
   JE RES

   CALL SAYILARI_YAZDIR  
   
JMP ENDLESS

RET
START ENDP

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SAYILARI_YAZDIR PROC NEAR

MOV AL,0FFH ;DEGER DEGISMESSE LED SONDUR
CMP SAYI2_CTR,0
JNA DEVAM
MOV AL,SONUC ;SONUCU YAZDIR
JMP YAZDIR

DEVAM:
CMP OP_CTR,1
JNE DEVAM2
MOV AL,0  ;OP GIRILDIYSE 0 YAZDIR
JMP YAZDIR

DEVAM2:
CMP SAYI1_CTR, 0
JNA YAZDIR
MOV AX, SAYI1 ;SAYI 1 I YAZDIR
JMP YAZDIR

YAZDIR:
;AL NIN ICINDEKI SAYIYI YAZDIR
MOV DX,402H  
OUT DX,AL
BITIR:

RET 
SAYILARI_YAZDIR ENDP 
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;



TUSU_KAYDET PROC NEAR
   CALL SAYILARI_YAZDIR
   MOV DX ,400H ;PORT A
   IN AL,DX
   XOR BX,BX
   AND AL,0FH ;ILK 4 BITI MASKELE
   MOV BL,AL
   
  ;1. SAYI GIRILDI MI			1------
   CMP SAYI1_CTR,2
   JNB DOLU1
   ;BOSSA YAPILACAKLAR  
   CMP SAYI1_CTR ,0
   JNE EKLE1
   MOV AL,TYPES[BX] ;BL NIN TIPINE GORE AX TE SONUC DONDURUR
   CMP AL,1	   ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
   JNE ERROR	   ;SAYI DEGILSE
   XOR AX,AX
   MOV AL,DECIMAL[BX] ;SAYININ DEC KARSILIGI
   MOV SAYI1,AX       
   ADD SAYI1_CTR ,1
   JMP CIK
	       
EKLE1:
   CMP OP_CTR ,0  ;OPERATOR GIRILDIYSE ILK SAYIYI ARTIK GEC
   JNE DOLU1
   MOV AL,TYPES[BX] ;BL NIN TIPINE GORE AX TE SONUC DONDURUR
   CMP AL,1	   ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
   JNE DOLU1 	    ;SAYI DEGILSE
   ;SAYI 1 FORMATI:
   ;GIRILEN SAYI 11 ISE 0001 0001 B SEKLINDE TUTULUR
   MOV DX,SAYI1     
   SHL DL,1
   SHL DL,1
   SHL DL,1
   SHL DL,1
   MOV AL,DECIMAL[BX]
   ADD AL,DL

   MOV SAYI1,AX        ;SAYI1 SAKLANIR
   ADD SAYI1_CTR, 1	;SAYI1 IN BASAMAK DEGERI ARTTIRILIR
   JMP CIK
	        

   DOLU1:  
   ;OPERATOR GIRILDI MI		2-----
   CMP OP_CTR,0
   JNE DOLU2      
   ;GIRILMEDIYSE YAPILACAKLAR
   MOV AL,TYPES[BX] ;BL NIN TIPINE GORE AX TE SONUC DONDURUR
   CMP AL,2	   ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
   JNE  START	    ;OP DEGILSE   
    MOV OP,BX
    ADD OP_CTR ,1
    JMP CIK
	       
DOLU2:
   ;2. SAYI GIRILDIMI 		3----
   CMP SAYI2_CTR,2
   JNB ERROR
   ;BOSSA YAPILACAKLAR  
   CMP SAYI2_CTR ,0
   JNE EKLE2
   MOV AL,TYPES[BX] ;BL NIN TIPINE GORE AX TE SONUC DONDURUR
   CMP AL,1	   ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
   JNE ERROR	    ;ILK INPUT SAYI OLMALI
   XOR AX,AX
   MOV AL,DECIMAL[BX]
   MOV SAYI2,AX
   ADD SAYI2_CTR ,1
   CALL SONUCU_HESAPLA
   JMP CIK
   	       
EKLE2:
   ;2SAYI NIN 2 BASAMAGI BEKLENIYOR
   CMP OP_CTR ,0  ;OPERAND GIRILDIYSE OP_CTR 1
   JE ERROR	;OPERAND HENUZ GIRILMEDIYSE ERROR STATE E GIDER
   MOV AL,TYPES[BX] ;BL NIN TIPINE GORE AX TE SONUC DONDURUR
   CMP AL,1	   ;SAYIYSA 1 ;OPERANDSA 2 ;DIGER 0
   JNE ERROR	    ;SAYI DEGILSE
   ;1 SAYI KAYDIRILIR VE 2 BASAMAK EKLENIR
   MOV DX,SAYI2
   SHL DL,1
   SHL DL,1
   SHL DL,1
   SHL DL,1
   MOV AL,DECIMAL[BX]
   ADD AL,DL

   MOV SAYI2,AX ;YENI SAYI DEGERI SAKLANIR
	
   ADD SAYI2_CTR, 1
   CALL SONUCU_HESAPLA ;SONUCU HESAPLA
   JMP CIK
	       ;CALL SAYILARI_YAZDIR
JMP  CIK
ERROR:
MOV DX,-1
  
CIK:
RET
TUSU_KAYDET ENDP
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
RESET PROC NEAR
      ;RESET
      MOV SAYI1_CTR  ,00H
      MOV OP_CTR     ,00H
      MOV SAYI2_CTR  ,00H
      MOV SAYI1	   ,0000H	
      MOV SAYI2	   ,0000H
      MOV OP       ,0000H

RET
RESET ENDP
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;

;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
SONUCU_HESAPLA PROC NEAR

;2. SAYININ DECIMAL DEGERI ELDE EDILIR
MOV CX,SAYI2
AND CX,00F0H
SHR CX,1
SHR CX,1
SHR CX,1
SHR CX,1
XOR AX,AX
MOV AX,10
MUL CL
MOV CX,SAYI2
AND CX,000FH
ADD AX,CX
MOV SAYI2,AX

;1. SAYININ DECIMAL DEGERI ELDE EDILIR
MOV CX,SAYI1
AND CX,00F0H
SHR CX,1
SHR CX,1
SHR CX,1
SHR CX,1
XOR AX,AX
MOV AX,10
MUL CL
MOV CX,SAYI1
AND CX,000FH
ADD AX,CX

;OPERATOR TIPI BELIRLENIR
CMP OP,0 
JE TOPLA
CMP OP,4
JE CIKAR
CMP OP,8
JE CARP
CMP OP,12
JE BOL

JMP SONA 
TOPLA:
   ADD AX,SAYI2
   JMP SONA

CIKAR:
   SUB AX,SAYI2
   JMP SONA
CARP:
   MUL SAYI2
   JMP SONA

BOL:
   XOR DX,DX
   XOR AH,AH
   MOV BX,SAYI2
   DIV BL
   JMP SONA
SONA:
CMP AL,100   ;SONUC 100 DEN BUYUKSE TASMA VAR 0 YAZDIR
JNB TASTI
CMP AL,0     ;SONUC NEGATIFSE 0 YAZDIR
JNA TASTI

;SONUC YAZDIRILABILIR FORMATA GETIRILIR
MOV BL,10
DIV BL
SHL AL,1
SHL AL,1
SHL AL,1
SHL AL,1
ADD AL,AH
MOV SONUC,AL

JMP GEC3
TASTI:MOV SONUC,00H 
GEC3:

RET
SONUCU_HESAPLA ENDP
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;


CODE    ENDS
        END START